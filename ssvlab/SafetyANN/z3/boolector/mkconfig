#!/bin/sh

die () {
   echo "*** mkconfig: $*" 1>&2
   exit 1
}

[ -f makefile ] || die "can not find 'makefile'"

cat<<EOF
/**********************************************************/
/* Automatically generated by './mkconfig': do note edit! */
/**********************************************************/
EOF

if [ ! x"`grep '^CC=gcc$' makefile`" =  x ]
then
  patchgccversion="`gcc --version|head -1|sed -e 's/,/ /g'`"
  patchgccversion="s,gcc,$patchgccversion,g"
else
  patchgccversion="s,DUMMY,DUMMY,"
fi

sed \
  -e '/^C[A-Z]*=/!d' \
  -e 's,^,#define BTOR_,' \
  -e 's,= *, ",' \
  -e 's,$,",' \
  makefile | sed -e "$patchgccversion"

echo "#define BTOR_OS \"`uname -srmn`\""
echo "#define BTOR_COMPILED \"`date`\""
cat<<EOF
#define BTOR_RELEASED "Wed Oct 29 15:03:13 CET 2014"
#define BTOR_VERSION "2.0.1"
#define BTOR_ID "bfafa40e5e4c9eb43e92bab7fa7095f5c0d4a421"
EOF
